#!/bin/bash

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env
export $(grep -v '^#' .env | xargs)

# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤ –≤ –º–∞—Å—Å–∏–≤
IFS=',' read -r -a prohibited_words <<< "$PROHIBITED_WORDS"

# –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞
commit_message=$(cat "$1")

# –í—ã–≤–æ–¥ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
#echo "–¢–µ–∫—Å—Ç –∫–æ–º–º–∏—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω: '$commit_message'"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
contains_prohibited_word=false
for word in "${prohibited_words[@]}"; do
  if [[ "$commit_message" == *"$word"* ]]; then
    contains_prohibited_word=true
    break
  fi
done

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞ –∫–æ–º–º–∏—Ç–∞
# –£–ø—Ä–æ—â–∞–µ–º —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
regex="^(feat|fix)\((FKIS|COMMON)-[0-9]{4}\): .+"

if [[ ! $commit_message =~ $regex ]]; then
  echo "ü§ñ –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–æ–º–º–∏—Ç–∞."
  echo "–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π —Ñ–æ—Ä–º–∞—Ç: feat(FKIS-0000): —Ç–µ–∫—Å—Ç –∏–ª–∏ fix(FKIS-0000): —Ç–µ–∫—Å—Ç"
  exit 1
elif [[ "$contains_prohibited_word" == true ]]; then
  echo " ‚õî No-no-no! –¢–µ–∫—Å—Ç –∫–æ–º–º–∏—Ç–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–ª–æ—Ö–∏–µ —Å–ª–æ–≤–µ—á–∫–∏."
  exit 1
else
  echo " ü§ó –¢–µ–∫—Å—Ç –∫–æ–º–º–∏—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π. –¢—ã –º–æ–ª–æ–¥–µ—Ü!"
  exit 0
fi
